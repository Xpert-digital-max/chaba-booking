<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å - ‡∏ä‡∏ö‡∏≤‡∏£‡∏µ‡∏™‡∏≠‡∏£‡πå‡∏ï ‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap');
        body { font-family: 'Prompt', sans-serif; background-color: #F3F4F6; }
        .room-card { transition: all 0.2s; border: 2px solid transparent; }
        .room-card.selected { border-color: #1DB446; background-color: #F0FDF4; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .loading-spinner { border: 4px solid #f3f3f3; border-top: 4px solid #1DB446; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen pb-12 relative max-w-md mx-auto bg-white shadow-2xl overflow-hidden hidden">
        
        <div class="relative h-56">
            <img src="https://images.unsplash.com/photo-1566073771259-6a8506099945?auto=format&fit=crop&q=80&w=1000" class="w-full h-full object-cover" />
            <div class="absolute inset-0 bg-black/40 flex flex-col justify-end p-6 text-white">
                <h1 class="text-3xl font-bold">Chaba Resort</h1>
                <p class="flex items-center gap-1 text-green-300 text-sm">üìç ‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ</p>
            </div>
            <button onclick="openAdmin()" class="absolute top-4 right-4 bg-white/20 p-2 rounded-full text-white hover:bg-white/30">‚öôÔ∏è</button>
        </div>

        <div class="p-6 -mt-6 relative z-10 bg-white rounded-t-3xl">
            <div class="flex items-center gap-3 mb-6 bg-green-50 p-3 rounded-xl border border-green-100">
                <img id="userImage" src="https://via.placeholder.com/100" class="w-10 h-10 rounded-full border border-green-200" />
                <div>
                    <div class="text-xs text-green-600 font-bold">‡∏à‡∏≠‡∏á‡πÉ‡∏ô‡∏ô‡∏≤‡∏°</div>
                    <div id="userName" class="font-semibold text-gray-700">Guest</div>
                </div>
            </div>

            <form id="bookingForm" onsubmit="submitBooking(event)" class="space-y-6">
                <div class="space-y-3">
                    <label class="flex items-center gap-2 text-gray-700 font-bold">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å</label>
                    <div class="grid grid-cols-2 gap-3">
                        <input type="date" id="checkIn" required class="bg-gray-50 border rounded-lg p-2.5 w-full" onchange="handleCheckIn()">
                        <input type="date" id="checkOut" required disabled class="bg-gray-50 border rounded-lg p-2.5 w-full disabled:bg-gray-200">
                    </div>
                </div>

                <div class="space-y-3">
                    <div class="flex justify-between">
                        <label class="flex items-center gap-2 text-gray-700 font-bold">üè° ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å</label>
                        <button type="button" onclick="loadRooms()" class="text-xs text-green-600">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
                    </div>
                    <div id="roomList" class="space-y-3 min-h-[100px]">
                        <div class="text-center py-4 text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
                    </div>
                    <input type="hidden" id="selectedRoom" required>
                </div>

                <div class="space-y-3">
                    <label class="flex items-center gap-2 text-gray-700 font-bold">üìû ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
                    <input type="tel" id="phone" required placeholder="08x-xxx-xxxx" class="w-full bg-gray-50 border rounded-lg p-3">
                </div>

                <button type="submit" id="submitBtn" disabled class="w-full py-4 rounded-xl font-bold text-white shadow-lg bg-gray-400 flex justify-center gap-2 transition-all">
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏ô
                </button>
            </form>
        </div>
    </div>

    <div id="loadingScreen" class="min-h-screen flex items-center justify-center bg-white">
        <div class="text-center">
            <div class="loading-spinner mb-4"></div>
            <p class="text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...</p>
        </div>
    </div>

    <div id="adminModal" class="fixed inset-0 z-50 bg-black/60 hidden flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-xl h-[80vh] flex flex-col p-4">
            <div class="flex justify-between mb-4 border-b pb-2">
                <h2 class="font-bold text-lg">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å</h2>
                <button onclick="closeAdmin()" class="text-gray-500 text-xl font-bold">&times;</button>
            </div>
            <div id="adminRoomList" class="overflow-y-auto flex-1 space-y-3"></div>
            <button onclick="openEditRoom()" class="mt-3 w-full border-2 border-dashed p-3 text-green-600 border-green-600 rounded-xl font-bold">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å</button>
        </div>
    </div>

    <script>
        // ‚ñº‚ñº‚ñº ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ) ‚ñº‚ñº‚ñº
        const CONFIG = {
            LIFF_ID: "2009043114-Ndo88F4L",
            WEB_APP_URL: "https://script.google.com/macros/s/AKfycbxU_Z-oGVJxLwBFCP4nb-C2ZzLS3gg0CAVXXdmGoQlF2OWCWcqbIIlULzkOVEauJBy0/exec" 
        };

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global
        let roomsData = [];
        let userProfile = { userId: 'Guest', displayName: '‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', pictureUrl: '' };

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
        window.onload = async () => {
            try {
                // 1. Initialize LIFF
                if (CONFIG.LIFF_ID) {
                    await liff.init({ liffId: CONFIG.LIFF_ID });
                    if (liff.isLoggedIn()) {
                        const profile = await liff.getProfile();
                        userProfile = profile;
                        document.getElementById('userImage').src = profile.pictureUrl || "https://via.placeholder.com/100";
                        document.getElementById('userName').innerText = profile.displayName;
                    } else {
                        // liff.login(); // ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö Login
                    }
                }
            } catch (e) {
                console.error("LIFF Error:", e);
            }

            // 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('checkIn').min = today;

            // 3. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å
            await loadRooms();

            // 4. ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
        };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å
        async function loadRooms() {
            const list = document.getElementById('roomList');
            list.innerHTML = '<div class="text-center py-4 text-gray-400"><div class="loading-spinner"></div><br>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>';
            
            try {
                const response = await fetch(CONFIG.WEB_APP_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'get_rooms' })
                });
                const result = await response.json();
                
                if (result.status === 'success') {
                    roomsData = result.data;
                    renderRooms();
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                list.innerHTML = `<div class="text-center text-red-500 py-4">‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${error.message}<br><small>‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏≤‡∏£ Deploy ‡∏ß‡πà‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô Anyone ‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?</small></div>`;
            }
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å
        function renderRooms() {
            const list = document.getElementById('roomList');
            list.innerHTML = '';
            
            if (roomsData.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-400 py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</div>';
                return;
            }

            roomsData.forEach(room => {
                const isSelected = document.getElementById('selectedRoom').value === room.name;
                const html = `
                    <div onclick="selectRoom('${room.name}')" class="room-card flex rounded-xl overflow-hidden cursor-pointer bg-white border-gray-200 shadow-sm ${isSelected ? 'selected' : ''}">
                        <img src="${room.image || 'https://via.placeholder.com/150'}" class="w-24 h-24 object-cover bg-gray-200">
                        <div class="p-3 flex-1 flex flex-col justify-center">
                            <h4 class="font-bold text-gray-800">${room.name}</h4>
                            <div class="text-sm text-gray-500 line-clamp-1">${room.desc || '-'}</div>
                            <div class="text-green-600 font-bold mt-1">‡∏ø${room.price}</div>
                        </div>
                        ${isSelected ? '<div class="bg-green-500 text-white p-1 absolute top-2 right-2 rounded-full text-xs">‚úì</div>' : ''}
                    </div>
                `;
                list.innerHTML += html;
            });
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á
        function selectRoom(roomName) {
            document.getElementById('selectedRoom').value = roomName;
            renderRooms(); // Re-render ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ
            checkFormValidity();
        }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà Check-in
        function handleCheckIn() {
            const checkInVal = document.getElementById('checkIn').value;
            const checkOutInput = document.getElementById('checkOut');
            
            if (checkInVal) {
                const nextDay = new Date(checkInVal);
                nextDay.setDate(nextDay.getDate() + 1);
                checkOutInput.min = nextDay.toISOString().split('T')[0];
                checkOutInput.disabled = false;
                checkOutInput.value = ''; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤
            } else {
                checkOutInput.disabled = true;
            }
            checkFormValidity();
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î
        function checkFormValidity() {
            const room = document.getElementById('selectedRoom').value;
            const checkIn = document.getElementById('checkIn').value;
            const checkOut = document.getElementById('checkOut').value;
            const btn = document.getElementById('submitBtn');

            if (room && checkIn && checkOut) {
                btn.disabled = false;
                btn.classList.remove('bg-gray-400');
                btn.classList.add('bg-green-600', 'hover:bg-green-700');
                btn.innerText = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á';
            } else {
                btn.disabled = true;
                btn.classList.add('bg-gray-400');
                btn.classList.remove('bg-green-600', 'hover:bg-green-700');
                btn.innerText = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö';
            }
        }

        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
        async function submitBooking(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';

            const payload = {
                action: 'booking',
                checkIn: document.getElementById('checkIn').value,
                checkOut: document.getElementById('checkOut').value,
                roomType: document.getElementById('selectedRoom').value,
                phone: document.getElementById('phone').value,
                lineUserId: userProfile.userId,
                lineDisplayName: userProfile.displayName,
                linePictureUrl: userProfile.pictureUrl
            };

            try {
                // ‡πÉ‡∏ä‡πâ no-cors ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (Fire & Forget) ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô CORS Error
                await fetch(CONFIG.WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                Swal.fire({
                    icon: 'success',
                    title: '‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
                    text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ó‡∏≤‡∏á LINE',
                    confirmButtonText: '‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á',
                    confirmButtonColor: '#1DB446'
                }).then(() => {
                    liff.closeWindow();
                });

            } catch (error) {
                Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
                btn.disabled = false;
                btn.innerText = '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á';
            }
        }

        // --- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á Admin ---
        function openAdmin() {
            const modal = document.getElementById('adminModal');
            modal.classList.remove('hidden');
            renderAdminRooms();
        }

        function closeAdmin() {
            document.getElementById('adminModal').classList.add('hidden');
        }

        function renderAdminRooms() {
            const list = document.getElementById('adminRoomList');
            list.innerHTML = '';
            roomsData.forEach(room => {
                list.innerHTML += `
                    <div class="flex justify-between items-center border p-2 rounded-lg bg-gray-50">
                        <div>
                            <div class="font-bold">${room.name}</div>
                            <div class="text-xs text-gray-500">${room.price} ‡∏ö‡∏≤‡∏ó</div>
                        </div>
                        <div class="flex gap-2">
                            <button onclick='openEditRoom(${JSON.stringify(room)})' class="text-blue-500 p-1">‚úèÔ∏è</button>
                            <button onclick="deleteRoom('${room.id}')" class="text-red-500 p-1">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            });
        }

        function openEditRoom(room = null) {
            // ‡πÉ‡∏ä‡πâ SweetAlert2 ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° Popup ‡∏™‡∏ß‡∏¢‡πÜ
            Swal.fire({
                title: room ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å‡πÉ‡∏´‡∏°‡πà',
                html: `
                    <input id="swal-name" class="swal2-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á" value="${room ? room.name : ''}">
                    <input id="swal-price" class="swal2-input" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" value="${room ? room.price : ''}">
                    <textarea id="swal-desc" class="swal2-textarea" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">${room ? room.desc : ''}</textarea>
                    <div style="text-align:left; margin-top:10px;">
                        <label class="text-sm">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</label>
                        <input type="file" id="swal-file" class="block w-full text-sm mt-1">
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                confirmButtonColor: '#1DB446',
                preConfirm: () => {
                    const name = document.getElementById('swal-name').value;
                    const price = document.getElementById('swal-price').value;
                    const desc = document.getElementById('swal-desc').value;
                    const fileInput = document.getElementById('swal-file');
                    
                    if (!name || !price) {
                        Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤');
                        return false;
                    }

                    // ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
                    return new Promise((resolve) => {
                        if (fileInput.files.length > 0) {
                            const reader = new FileReader();
                            reader.onloadend = () => {
                                resolve({ id: room ? room.id : Date.now(), name, price, desc, image: room ? room.image : '', imageBase64: reader.result });
                            };
                            reader.readAsDataURL(fileInput.files[0]);
                        } else {
                            resolve({ id: room ? room.id : Date.now(), name, price, desc, image: room ? room.image : '' });
                        }
                    });
                }
            }).then(async (result) => {
                if (result.isConfirmed) {
                    Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
                    
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ö‡∏ö Optimistic UI (‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏•‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠)
                    const newRoom = result.value;
                    if (room) {
                        roomsData = roomsData.map(r => r.id === newRoom.id ? newRoom : r);
                    } else {
                        roomsData.push(newRoom);
                    }
                    renderAdminRooms();
                    renderRooms();

                    await fetch(CONFIG.WEB_APP_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify({ action: 'save_room', room: newRoom })
                    });
                    
                    Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', '', 'success');
                    // Reload ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á
                    setTimeout(loadRooms, 2000);
                }
            });
        }

        async function deleteRoom(id) {
            const result = await Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                confirmButtonText: '‡∏•‡∏ö‡πÄ‡∏•‡∏¢'
            });

            if (result.isConfirmed) {
                roomsData = roomsData.filter(r => r.id !== id);
                renderAdminRooms();
                renderRooms();
                
                await fetch(CONFIG.WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ action: 'delete_room', roomId: id })
                });
            }
        }
    </script>
</body>
</html>